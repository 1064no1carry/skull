
# dependency targets
flibs:
	$(MAKE) $(MAKE_FLAGS) -C ./deps/flibs -j4 || exit "$$?"

protos:
	cd src && $(MAKE) $@

metrics:
	cd config && ../tools/sk-metrics-gen.py -c metrics.yaml
	mv config/sk_metrics.h src/api
	mv config/sk_metrics.c src/common

.PHONY: flibs protos metrics

# install targets
install-core:
	cd src && $(MAKE) install

install-api:
	cd src/user-c && $(MAKE) install

install-others:
	test -d $(prefix)/etc/skull || mkdir -p $(prefix)/etc/skull
	cp ChangeLog.md $(prefix)/etc/skull

install-scripts:
	cd scripts && $(MAKE) install

.PHONY: install-core install-api install-others install-scripts

# clean targets

clean-flibs:
	$(MAKE) $(MAKE_FLAGS) -C ./deps/flibs clean || exit "$$?"

clean-protos:
	cd src && $(MAKE) $@

.PHONY: clean_flibs clean_protos
